<!DOCTYPE html><html><head><title>te9yie</title><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="google-site-verification" content="iMWdKZ02K2Yzj9AtOP4cl-40F5DJp-YJLQDzv9vQgMk"/><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="te9yie.github.io"/><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/261db87ca79a1b90f0bc.css" as="style"/><link rel="stylesheet" href="/_next/static/css/261db87ca79a1b90f0bc.css" data-n-g=""/><link rel="preload" href="/_next/static/css/18a619bacb7468e88ab5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/18a619bacb7468e88ab5.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-1f0b73d383aed819e4f2.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.29f9e2f3d4a33bafbaa5.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.3a16fc34825ffc7ba561.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-f09e6d1885159ec7f6c1.js" as="script"/><link rel="preload" href="/_next/static/chunks/7ac61503aba6d10b58e3c266d97d99b7b5b3721a.c1b518faff21babf1a9f.js" as="script"/><link rel="preload" href="/_next/static/chunks/5f8a2089eac11fe3b358516a6b612033195d4834.09c9bf1e9518111d6ffd.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/index-9b12f7e5ac7c7e4e6afc.js" as="script"/></head><body><div id="__next"><header><nav><ul><li><a id="site-name" href="/"><h1>te9yie</h1></a></li><li><a href="/b">Blog</a></li><li><a href="/w">Wiki</a></li><li><a href="/search">Search</a></li></ul></nav></header><article><h2><a class="index_permalink__UOudO" href="/b/2021-03-08">2021-03-08</a></h2><p><a class="wiki-link" href="/w/Rust">Rust</a>ã§<a class="wiki-link" href="/w/WebAssembly">WebAssembly</a>ã‚’ç”Ÿæˆã—ã‚ˆã†ã«ã‚‚ã€<a class="wiki-link" href="/w/webpack">webpack</a>ã®æŒ™å‹•ãŒç†è§£ã§ãã¦ãªãã¦æ„å‘³ãŒåˆ†ã‹ã‚‰ãªã„ã€‚ä¸€æ—¦<a class="wiki-link" href="/w/webpack">webpack</a>ä½¿ã‚ãšã«ã€<a class="wiki-link" href="/w/Rust">Rust</a>ã‹ã‚‰<code>wasm</code>ã‚’ç”Ÿæˆã—ã€ãã‚Œã‚’<a class="wiki-link" href="/w/HTML">HTML</a>ã‹ã‚‰èª­ã¿è¾¼ã‚€ã ã‘ã®ã¨ã“ã‚ã‹ã‚‰å§‹ã‚ã¦ã¿ã‚‹ã€‚</p><p><a class="wiki-link" href="/w/Rust">Rust</a>ã®ã‚¯ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦<code>wasm-bindgen</code>ã‚’ä½¿ã†ã€‚ã“ã‚Œã¯ã€<a class="wiki-link" href="/w/Rust">Rust</a>ã¨<a class="wiki-link" href="/w/JavaScript">JavaScript</a>ã®æ©‹æ¸¡ã—ã‚’ã—ã¦ãã‚Œã‚‹ã€‚ã‚ã¨<code>web-sys</code>ã€‚ã“ã‚Œã‚’ä½¿ã†ã¨<a class="wiki-link" href="/w/Rust">Rust</a>ã‹ã‚‰<a class="wiki-link" href="/w/DOM">DOM</a>ã‚’æ“ä½œã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚</p><p><code>lib.rs</code>:</p><pre><code class="language-rust">use wasm_bindgen::prelude::*;
use wasm_bindgen::JsCast;

#[wasm_bindgen(start)]
pub fn main() {
    let window = web_sys::window().unwrap();
    let document = window.document().unwrap();
    let canvas = document.get_element_by_id(&quot;canvas&quot;).unwrap();
    let canvas = canvas.dyn_into::&lt;web_sys::HtmlCanvasElement&gt;().unwrap();
    let context = canvas.get_context(&quot;2d&quot;).unwrap();
    let context = context
        .unwrap()
        .dyn_into::&lt;web_sys::CanvasRenderingContext2d&gt;()
        .unwrap();

    context.set_font(&quot;100% sans-serif&quot;);
    context.fill_text(&quot;Hello WASM!&quot;, 10.0, 20.0).unwrap();

    context.set_fill_style(&amp;&quot;red&quot;.into());
    context.fill_rect(20.0, 30.0, 40.0, 40.0);

    context.set_fill_style(&amp;&quot;green&quot;.into());
    context.fill_rect(40.0, 50.0, 40.0, 40.0);
}</code></pre><p><code>Cargo.toml</code>:</p><pre><code class="language-toml">[package]
name = &quot;hello-wasm-canvas&quot;
version = &quot;0.1.0&quot;
authors = [&quot;te9yie &lt;te9yie@users.noreply.github.com&gt;&quot;]
edition = &quot;2018&quot;

# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html

[lib]
crate-type = [&quot;cdylib&quot;]

[dependencies]
wasm-bindgen = &quot;*&quot;

[dependencies.web-sys]
version = &quot;*&quot;
features = [
    &quot;CanvasRenderingContext2d&quot;,
    &quot;Document&quot;,
    &quot;Element&quot;,
    &quot;HtmlCanvasElement&quot;,
    &quot;Window&quot;,
]</code></pre><p>ãƒ“ãƒ«ãƒ‰ã—ã¦ã¿ã‚‹ã€‚</p><pre><code class="language-bash">$ wasm-pack build --target web</code></pre><p><code>pkg</code>ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒç”Ÿæˆã•ã‚Œã‚‹ã€‚</p><pre><code class="language-bash">pkg
â”œâ”€â”€ hello_wasm_canvas.d.ts
â”œâ”€â”€ hello_wasm_canvas.js
â”œâ”€â”€ hello_wasm_canvas_bg.wasm
â”œâ”€â”€ hello_wasm_canvas_bg.wasm.d.ts
â””â”€â”€ package.json</code></pre><p><a class="wiki-link" href="/w/TypeScript">TypeScript</a>ç”¨ã®å‹æƒ…å ±ã‚‚ç”Ÿæˆã•ã‚Œã‚‹ã‚“ã ãªã€‚</p><p>ã“ã‚Œã‚’èª­ã¿è¾¼ã‚€<a class="wiki-link" href="/w/HTML">HTML</a>ã‚’æ›¸ã„ã¦ã¿ã‚‹ã€‚</p><p><code>index.html</code>:</p><pre><code class="language-html">&lt;html&gt;
    &lt;body&gt;
        &lt;script type=&quot;module&quot;&gt;
            import init from &quot;./pkg/hello_wasm_canvas.js&quot;;
            const run = async () =&gt; {
                await init();
            }
            run();
        &lt;/script&gt;
        &lt;canvas id=&quot;canvas&quot; /&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre><p>é©å½“ã«ã‚µãƒ¼ãƒã‚’ç«‹ã¦ã¦ç¢ºèªã—ã¦ã¿ã‚‹ã€‚</p><pre><code class="language-bash">$ npx serve</code></pre><p>å‹•ã„ãŸï¼</p><p><a class="wiki-link" href="/w/webpack">webpack</a>ã§ã“ã‚“ãªæ„Ÿã˜ã®<a class="wiki-link" href="/w/HTML">HTML</a>ã‚’ç”Ÿæˆã—ãŸã‚Šã—ã¦ãŸã‚“ã ãªã€‚ãã‚Œã ã‘ãªã®ã«ãªã‚“ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³4ã¨5ã§ã‚ã‚“ãªã«æŒ™å‹•ãŒå¤‰ã‚ã‚‹ã‚“ã ã‚ã†ã€‚<a class="wiki-link" href="/w/webpack">webpack</a>ã®<code>html-webpack-plugin</code>ã¨<code>wasm-pack-plugin</code>ã‚ãŸã‚Šã‚’èª¿ã¹ã¦ã¿ã‚ˆã†ã‹ã€‚ã©ã†ã›ãªã‚‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³5ã®æ–¹ã§å‹•ã‹ã—ã¦ã¿ãŸã„ã€‚</p></article><article><h2><a class="index_permalink__UOudO" href="/b/2021-03-07">2021-03-07</a></h2><p><a class="wiki-link" href="/w/Rust">Rust</a>ã‹ã‚‰<a class="wiki-link" href="/w/WebAssembly">WebAssembly</a>ã‚’ä½œã£ã¦ã¿ã‚‹ã€‚</p><p><a href="https://rustwasm.github.io/docs/wasm-bindgen/examples/hello-world.html">Hello, World! - The <code>wasm-bindgen</code> Guide</a>ã‚’å‚è€ƒã«ã‚„ã£ã¦ã¿ãŸã‚“ã ã‘ã©ã€è‰²ã€…ä¸Šæ‰‹ãå‹•ã‹ãªã‹ã£ãŸã€‚</p><pre><code class="language-bash">$ cargo new hello-wasm --lib
$ cd hello-wasm
$ yarn init -y
$ yarn add -D @wasm-tool/wasm-pack-plugin text-encoding html-webpack-plugin webpack webpack-cli webpack-dev-server
$ code . # ã‚µãƒ³ãƒ—ãƒ«ã®ã‚³ãƒ¼ãƒ‰ã‚’å‚è€ƒã«è‰²ã€…æ›¸ã
$ yarn build</code></pre><p>ã“ã“ã§ã‚¨ãƒ©ãƒ¼</p><pre><code class="language-bash">yarn run v1.22.10
$ webpack
ğŸ§  Checking for wasm-pack...

â„¹ï¸  Installing wasm-pack 

[webpack-cli] Error: Rust compilation.
    at ChildProcess.p.on.code (/home/i/w/hello-wasm/node_modules/@wasm-tool/wasm-pack-plugin/plugin.js:221:16)
    at ChildProcess.emit (events.js:198:13)
    at maybeClose (internal/child_process.js:982:16)
    at Socket.stream.socket.on (internal/child_process.js:389:11)
    at Socket.emit (events.js:198:13)
    at Pipe._handle.close (net.js:607:12)
error Command failed with exit code 2.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.</code></pre><p><code>cargo build</code>ã¯å•é¡Œãªãã¦<code>$(npm bin)/webpack</code>ã—ãŸã‚‰ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚<br/><code>wasm-pack-plugin</code>ã£ã¦ã®ã§ã‚³ã‚±ã¦ãã†ã ã£ãŸã®ã§ã€<a href="https://github.com/wasm-tool/wasm-pack-plugin">wasm-tool/wasm-pack-plugin: webpack plugin for Rust</a>ã‚’è¦‹ã«è¡Œã£ãŸã‚‰ã€<code>wasm-pack</code>ã‚’å…¥ã‚Œã‚ã£ã¦æ›¸ã„ã¦ã‚ã£ãŸã€‚ã‚ˆãè¦‹ã‚‹ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚‚<code>Installing wasm-pack</code>ã£ã¦å‡ºã¦ãŸã€‚</p><pre><code class="language-bash">$ cargo install wasm-pack
$ yarn build</code></pre><p>ã¾ãŸã‚¨ãƒ©ãƒ¼</p><pre><code class="language-bash">yarn run v1.22.10
$ webpack
ğŸ§  Checking for wasm-pack...

âœ…  wasm-pack is installed at /home/i/.cargo/bin/wasm-pack. 

â„¹ï¸  Compiling your crate in development mode...

[INFO]: Checking for the Wasm target...
[INFO]: Compiling to Wasm...
   Compiling cfg-if v1.0.0
   Compiling wasm-bindgen v0.2.71
   Compiling hello-wasm v0.1.0 (/home/i/w/hello-wasm)
    Finished dev [unoptimized + debuginfo] target(s) in 0.83s
:-) [WARN]: origin crate has no README
[INFO]: Installing wasm-bindgen...
[INFO]: Optional fields missing from Cargo.toml: &#x27;description&#x27;, &#x27;repository&#x27;, and &#x27;license&#x27;. These are not necessary, but recommended
[INFO]: :-) Done in 1.06s
[INFO]: :-) Your wasm pkg is ready to publish at /home/i/w/hello-wasm/pkg.
âœ…  Your crate has been correctly compiled

asset vendors-node_modules_text-encoding_index_js.index.js 623 KiB [emitted] (id hint: vendors)
asset index.js 13.3 KiB [emitted] (name: main)
asset pkg_index_js.index.js 7.28 KiB [emitted]
asset index.html 232 bytes [emitted]
runtime modules 7.32 KiB 11 modules
cacheable modules 692 KiB
  modules by path ./pkg/ 74.7 KiB
    ./pkg/index.js 71 bytes [built] [code generated]
    ./pkg/index_bg.js 3.25 KiB [built] [code generated]
    ./pkg/index_bg.wasm 71.4 KiB [built] [code generated] [1 error]
  modules by path ./node_modules/text-encoding/ 617 KiB
    ./node_modules/text-encoding/index.js 258 bytes [built] [code generated]
    ./node_modules/text-encoding/lib/encoding.js 99.1 KiB [built] [code generated]
    ./node_modules/text-encoding/lib/encoding-indexes.js 518 KiB [built] [code generated]
  ./index.js 88 bytes [built] [code generated]

ERROR in ./pkg/index_bg.wasm 1:0
Module parse failed: Unexpected character &#x27;&#x27; (1:0)
The module seem to be a WebAssembly module, but module is not flagged as WebAssembly module for webpack.
BREAKING CHANGE: Since webpack 5 WebAssembly is not enabled by default and flagged as experimental feature.
You need to enable one of the WebAssembly experiments via &#x27;experiments.asyncWebAssembly: true&#x27; (based on async modules) or &#x27;experiments.syncWebAssembly: true&#x27; (like webpack 4, deprecated).
For files that transpile to WebAssembly, make sure to set the module type in the &#x27;module.rules&#x27; section of the config (e. g. &#x27;type: &quot;webassembly/async&quot;&#x27;).
(Source code omitted for this binary file)
 @ ./pkg/index.js 1:0-40
 @ ./index.js 1:13-28

webpack 5.24.3 compiled with 1 error in 1526 ms
error Command failed with exit code 1.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.</code></pre><p><code>experiments.asyncWebAssembly: true</code>ã«ã—ã¦<code>module.rules</code>ã‚’è¨­å®šã—ã‚ã¨ã®ã“ã¨ãªã®ã§<code>webpack.config.js</code>ã‚’ä¿®æ­£ã—ãŸã€‚</p><pre><code class="language-diff">+  experiments: {
+    asyncWebAssembly: true,
+  },
+  module: {
+    rules: [
+      {
+        test: /\.wasm/,
+        type: &quot;webassembly/async&quot;,
+      },
+    ],
+  },</code></pre><p><code>yarn build</code>ãŒé€šã£ãŸã®ã§<code>yarn serve</code>ã—ã¦ã¿ã‚‹ã€‚ã‚¨ãƒ©ãƒ¼ã€‚</p><pre><code class="language-bash">$ yarn serve
yarn run v1.22.10
$ webpack-dev-server
internal/modules/cjs/loader.js:638
    throw err;
    ^

Error: Cannot find module &#x27;webpack-cli/bin/config-yargs&#x27;
    at Function.Module._resolveFilename (internal/modules/cjs/loader.js:636:15)
    at Function.Module._load (internal/modules/cjs/loader.js:562:25)
    at Module.require (internal/modules/cjs/loader.js:692:17)
    at require (internal/modules/cjs/helpers.js:25:18)
    at Object.&lt;anonymous&gt; (/home/i/w/hello-wasm/node_modules/webpack-dev-server/bin/webpack-dev-server.js:65:1)
    at Module._compile (internal/modules/cjs/loader.js:778:30)
    at Object.Module._extensions..js (internal/modules/cjs/loader.js:789:10)
    at Module.load (internal/modules/cjs/loader.js:653:32)
    at tryModuleLoad (internal/modules/cjs/loader.js:593:12)
    at Function.Module._load (internal/modules/cjs/loader.js:585:3)
error Command failed with exit code 1.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.</code></pre><p><a href="https://iwb.jp/webpack-cli-dev-server-error-config-yargs/">webpackã§Webã‚µãƒ¼ãƒãƒ¼ã§ã®ç¢ºèªã«webpack-dev-serverã¯ä¸å¯ | iwb.jp</a>ã§ã€<code>webpack-cli serve</code>ã‚’ä½¿ãˆã¨ã®ã“ã¨ãªã®ã§ã€ä¿®æ­£ã—ã¦ã¿ã‚‹ã€‚</p><pre><code class="language-diff">-    &quot;serve&quot;: &quot;webpack-dev-server&quot;
+    &quot;serve&quot;: &quot;webpack-cli serve --open --mode development&quot;</code></pre><p>ã‚¨ãƒ©ãƒ¼ãªãå‹•ã„ãŸã€‚ãŒã€ä½•ã‚‚èµ·ããªã„ã€‚ã©ã†ãªã£ã¦ã‚“ã ï¼Ÿã¨æ€ã£ã¦ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã‚’è¦‹ãŸã‚‰ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ãŸã€‚</p><pre><code>TypeError: Cannot read property &#x27;__wbindgen_malloc&#x27; of undefined
    at Module.greet (index_bg.js:115)
    at eval (index.js:4)</code></pre><p>â€¦ç„¡ç†ã€‚ã‚‚ã†åˆ†ã‹ã‚“ãªã„ã€‚<br/>ãã‚‚ãã‚‚ã‚µãƒ³ãƒ—ãƒ«å‹•ãã‚“ã‹ã‚ˆã€‚ã¨æ€ã£ã¦</p><p><a href="https://github.com/rustwasm/wasm-bindgen/tree/master/examples/hello_world">https://github.com/rustwasm/wasm-bindgen/tree/master/examples/hello_world</a></p><p>ã‚’è©¦ã—ãŸã‚‰å‹•ã„ãŸã€‚<br/>ä½•ãŒé•ã†ã‚“ã ã¨æ€ã£ã¦ã‚ˆãè¦‹æ¯”ã¹ã‚‹ã¨<code>package.json</code>ãŒé•ã£ãŸã€‚</p><pre><code class="language-diff">-    &quot;html-webpack-plugin&quot;: &quot;^5.2.0&quot;,
-    &quot;webpack&quot;: &quot;^5.24.3&quot;,
-    &quot;webpack-cli&quot;: &quot;^4.5.0&quot;,
-    &quot;webpack-dev-server&quot;: &quot;^3.11.2&quot;
+    &quot;html-webpack-plugin&quot;: &quot;^3.2.0&quot;,
+    &quot;webpack&quot;: &quot;^4.29.4&quot;,
+    &quot;webpack-cli&quot;: &quot;^3.1.1&quot;,
+    &quot;webpack-dev-server&quot;: &quot;^3.1.0&quot;</code></pre><p>ã•ã£ãã‹ã‚‰ã‚¨ãƒ©ãƒ¼ã®å†…å®¹ã‚‚å¤§ä½“<a class="wiki-link" href="/w/webpack">webpack</a>ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ4ã˜ã‚ƒãªãã¦5ã ã‹ã‚‰å‡ºã¦ã‚‹é›°å›²æ°—ã‚’é†¸ã—å‡ºã—ã¦ã„ãŸã€‚ãªã‚“ã§ã‚‚æœ€æ–°ã˜ã‚ƒã ã‚ãªã‚“ã ã­ã‡ã€‚</p><p>ã¨ã‚Šã‚ãˆãš<a class="wiki-link" href="/w/webpack">webpack</a>ã‚ãŸã‚Šã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’4ã«ã—ã¦ã¿ã‚‹ã€‚</p><pre><code class="language-diff">-    &quot;html-webpack-plugin&quot;: &quot;^5.2.0&quot;,
-    &quot;webpack&quot;: &quot;^5.24.3&quot;,
+    &quot;html-webpack-plugin&quot;: &quot;^4.0.0&quot;,
+    &quot;webpack&quot;: &quot;^4.0.0&quot;,</code></pre><p>å‹•ã„ãŸã€‚</p><h3>ã¾ã¨ã‚</h3><p>ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆã‚ã›ã‚‹ã®å¤§äº‹ï¼ï¼ï¼</p></article><article><h2><a class="index_permalink__UOudO" href="/b/2021-03-06">2021-03-06</a></h2><p>æœ€è¿‘æ°—ã«ãªã£ã¦ã„ãŸè¨€èªãŒäºŒã¤ã‚ã‚‹ã€‚</p><p>ä¸€ã¤ã¯<a class="wiki-link" href="/w/TypeScript">TypeScript</a>ã€ã‚‚ã†ä¸€ã¤ãŒ<a class="wiki-link" href="/w/Rust">Rust</a>ã ã€‚</p><p><a class="wiki-link" href="/w/C++">C++</a>ãŒä¸€ç•ªé•·ã„æœŸé–“è§¦ã£ã¦ã„ã¦å¥½ããªè¨€èªãªã‚“ã ã‘ã©ã€C++17ã‚ãŸã‚Šã‹ã‚‰ã®é€²åŒ–ã®æ–¹å‘æ€§ã«é•å’Œæ„ŸãŒã‚ã£ã¦ãªã‚“ã ã‹ãªã‚ã¨æ€ã£ã¦ã„ã‚‹ã€‚é€†ã«<a class="wiki-link" href="/w/C%E8%A8%80%E8%AA%9E">Cè¨€èª</a>ã«æˆ»ã£ã¦ã¿ã‚‹ã‹ï¼Ÿã¨æ€ã£ãŸã‚Šã‚‚ã—ãŸã‚“ã ã‘ã©ã€ãã‚“ãªæŠ˜ã«ã€ã©ã†ã‚‚<a class="wiki-link" href="/w/Rust">Rust</a>ãŒè‰¯ã•ãã†ã¨ã„ã†å™‚ã‚’èã„ãŸã€‚</p><p>ã¾ãšã¯å…¬å¼ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰èª­ã‚“ã§ã„ãã€‚</p><p><a href="https://doc.rust-jp.rs/book-ja/title-page.html">The Rust Programming Language æ—¥æœ¬èªç‰ˆ - The Rust Programming Language æ—¥æœ¬èªç‰ˆ</a></p><p>è¨€èªã‚„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã‚“ã§ã‚‚ãªã‚“ã ã‘ã©ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒã—ã£ã‹ã‚Šã—ã¦ã„ã‚‹ã¨å®‰å¿ƒæ„ŸãŒã‚ã‚‹ã€‚</p><hr/><p>ã¨ã‚Šã‚ãˆãš<a class="wiki-link" href="/w/VS%20Code%20Remote%20Development">VS Code Remote Development</a>ã§<a class="wiki-link" href="/w/Rust">Rust</a>ã®é–‹ç™ºç’°å¢ƒã‚’æ•´ãˆã‚‹ã€‚</p></article><footer>Â© <!-- -->2021<!-- --> <!-- -->te9yie</footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":[{"id":"2021-03-08","content":"[[Rust]]ã§[[WebAssembly]]ã‚’ç”Ÿæˆã—ã‚ˆã†ã«ã‚‚ã€[[webpack]]ã®æŒ™å‹•ãŒç†è§£ã§ãã¦ãªãã¦æ„å‘³ãŒåˆ†ã‹ã‚‰ãªã„ã€‚ä¸€æ—¦[[webpack]]ä½¿ã‚ãšã«ã€[[Rust]]ã‹ã‚‰`wasm`ã‚’ç”Ÿæˆã—ã€ãã‚Œã‚’[[HTML]]ã‹ã‚‰èª­ã¿è¾¼ã‚€ã ã‘ã®ã¨ã“ã‚ã‹ã‚‰å§‹ã‚ã¦ã¿ã‚‹ã€‚\n\n[[Rust]]ã®ã‚¯ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦`wasm-bindgen`ã‚’ä½¿ã†ã€‚ã“ã‚Œã¯ã€[[Rust]]ã¨[[JavaScript]]ã®æ©‹æ¸¡ã—ã‚’ã—ã¦ãã‚Œã‚‹ã€‚ã‚ã¨`web-sys`ã€‚ã“ã‚Œã‚’ä½¿ã†ã¨[[Rust]]ã‹ã‚‰[[DOM]]ã‚’æ“ä½œã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚\n\n`lib.rs`:\n\n```rust\nuse wasm_bindgen::prelude::*;\nuse wasm_bindgen::JsCast;\n\n#[wasm_bindgen(start)]\npub fn main() {\n    let window = web_sys::window().unwrap();\n    let document = window.document().unwrap();\n    let canvas = document.get_element_by_id(\"canvas\").unwrap();\n    let canvas = canvas.dyn_into::\u003cweb_sys::HtmlCanvasElement\u003e().unwrap();\n    let context = canvas.get_context(\"2d\").unwrap();\n    let context = context\n        .unwrap()\n        .dyn_into::\u003cweb_sys::CanvasRenderingContext2d\u003e()\n        .unwrap();\n\n    context.set_font(\"100% sans-serif\");\n    context.fill_text(\"Hello WASM!\", 10.0, 20.0).unwrap();\n\n    context.set_fill_style(\u0026\"red\".into());\n    context.fill_rect(20.0, 30.0, 40.0, 40.0);\n\n    context.set_fill_style(\u0026\"green\".into());\n    context.fill_rect(40.0, 50.0, 40.0, 40.0);\n}\n```\n\n`Cargo.toml`:\n\n```toml\n[package]\nname = \"hello-wasm-canvas\"\nversion = \"0.1.0\"\nauthors = [\"te9yie \u003cte9yie@users.noreply.github.com\u003e\"]\nedition = \"2018\"\n\n# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html\n\n[lib]\ncrate-type = [\"cdylib\"]\n\n[dependencies]\nwasm-bindgen = \"*\"\n\n[dependencies.web-sys]\nversion = \"*\"\nfeatures = [\n    \"CanvasRenderingContext2d\",\n    \"Document\",\n    \"Element\",\n    \"HtmlCanvasElement\",\n    \"Window\",\n]\n```\n\nãƒ“ãƒ«ãƒ‰ã—ã¦ã¿ã‚‹ã€‚\n\n```bash\n$ wasm-pack build --target web\n```\n\n`pkg`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒç”Ÿæˆã•ã‚Œã‚‹ã€‚\n\n```bash\npkg\nâ”œâ”€â”€ hello_wasm_canvas.d.ts\nâ”œâ”€â”€ hello_wasm_canvas.js\nâ”œâ”€â”€ hello_wasm_canvas_bg.wasm\nâ”œâ”€â”€ hello_wasm_canvas_bg.wasm.d.ts\nâ””â”€â”€ package.json\n```\n\n[[TypeScript]]ç”¨ã®å‹æƒ…å ±ã‚‚ç”Ÿæˆã•ã‚Œã‚‹ã‚“ã ãªã€‚\n\nã“ã‚Œã‚’èª­ã¿è¾¼ã‚€[[HTML]]ã‚’æ›¸ã„ã¦ã¿ã‚‹ã€‚\n\n`index.html`:\n\n```html\n\u003chtml\u003e\n    \u003cbody\u003e\n        \u003cscript type=\"module\"\u003e\n            import init from \"./pkg/hello_wasm_canvas.js\";\n            const run = async () =\u003e {\n                await init();\n            }\n            run();\n        \u003c/script\u003e\n        \u003ccanvas id=\"canvas\" /\u003e\n    \u003c/body\u003e\n\u003c/html\u003e\n```\n\né©å½“ã«ã‚µãƒ¼ãƒã‚’ç«‹ã¦ã¦ç¢ºèªã—ã¦ã¿ã‚‹ã€‚\n\n```bash\n$ npx serve\n```\n\nå‹•ã„ãŸï¼\n\n[[webpack]]ã§ã“ã‚“ãªæ„Ÿã˜ã®[[HTML]]ã‚’ç”Ÿæˆã—ãŸã‚Šã—ã¦ãŸã‚“ã ãªã€‚ãã‚Œã ã‘ãªã®ã«ãªã‚“ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³4ã¨5ã§ã‚ã‚“ãªã«æŒ™å‹•ãŒå¤‰ã‚ã‚‹ã‚“ã ã‚ã†ã€‚[[webpack]]ã®`html-webpack-plugin`ã¨`wasm-pack-plugin`ã‚ãŸã‚Šã‚’èª¿ã¹ã¦ã¿ã‚ˆã†ã‹ã€‚ã©ã†ã›ãªã‚‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³5ã®æ–¹ã§å‹•ã‹ã—ã¦ã¿ãŸã„ã€‚\n"},{"id":"2021-03-07","content":"[[Rust]]ã‹ã‚‰[[WebAssembly]]ã‚’ä½œã£ã¦ã¿ã‚‹ã€‚\n\n[Hello, World! - The `wasm-bindgen` Guide](https://rustwasm.github.io/docs/wasm-bindgen/examples/hello-world.html)ã‚’å‚è€ƒã«ã‚„ã£ã¦ã¿ãŸã‚“ã ã‘ã©ã€è‰²ã€…ä¸Šæ‰‹ãå‹•ã‹ãªã‹ã£ãŸã€‚\n\n```bash\n$ cargo new hello-wasm --lib\n$ cd hello-wasm\n$ yarn init -y\n$ yarn add -D @wasm-tool/wasm-pack-plugin text-encoding html-webpack-plugin webpack webpack-cli webpack-dev-server\n$ code . # ã‚µãƒ³ãƒ—ãƒ«ã®ã‚³ãƒ¼ãƒ‰ã‚’å‚è€ƒã«è‰²ã€…æ›¸ã\n$ yarn build\n```\n\nã“ã“ã§ã‚¨ãƒ©ãƒ¼\n\n```bash\nyarn run v1.22.10\n$ webpack\nğŸ§  Checking for wasm-pack...\n\nâ„¹ï¸  Installing wasm-pack \n\n[webpack-cli] Error: Rust compilation.\n    at ChildProcess.p.on.code (/home/i/w/hello-wasm/node_modules/@wasm-tool/wasm-pack-plugin/plugin.js:221:16)\n    at ChildProcess.emit (events.js:198:13)\n    at maybeClose (internal/child_process.js:982:16)\n    at Socket.stream.socket.on (internal/child_process.js:389:11)\n    at Socket.emit (events.js:198:13)\n    at Pipe._handle.close (net.js:607:12)\nerror Command failed with exit code 2.\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\n```\n\n`cargo build`ã¯å•é¡Œãªãã¦`$(npm bin)/webpack`ã—ãŸã‚‰ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚\n`wasm-pack-plugin`ã£ã¦ã®ã§ã‚³ã‚±ã¦ãã†ã ã£ãŸã®ã§ã€[wasm-tool/wasm-pack-plugin: webpack plugin for Rust](https://github.com/wasm-tool/wasm-pack-plugin)ã‚’è¦‹ã«è¡Œã£ãŸã‚‰ã€`wasm-pack`ã‚’å…¥ã‚Œã‚ã£ã¦æ›¸ã„ã¦ã‚ã£ãŸã€‚ã‚ˆãè¦‹ã‚‹ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚‚`Installing wasm-pack`ã£ã¦å‡ºã¦ãŸã€‚\n\n```bash\n$ cargo install wasm-pack\n$ yarn build\n```\n\nã¾ãŸã‚¨ãƒ©ãƒ¼\n\n```bash\nyarn run v1.22.10\n$ webpack\nğŸ§  Checking for wasm-pack...\n\nâœ…  wasm-pack is installed at /home/i/.cargo/bin/wasm-pack. \n\nâ„¹ï¸  Compiling your crate in development mode...\n\n[INFO]: Checking for the Wasm target...\n[INFO]: Compiling to Wasm...\n   Compiling cfg-if v1.0.0\n   Compiling wasm-bindgen v0.2.71\n   Compiling hello-wasm v0.1.0 (/home/i/w/hello-wasm)\n    Finished dev [unoptimized + debuginfo] target(s) in 0.83s\n:-) [WARN]: origin crate has no README\n[INFO]: Installing wasm-bindgen...\n[INFO]: Optional fields missing from Cargo.toml: 'description', 'repository', and 'license'. These are not necessary, but recommended\n[INFO]: :-) Done in 1.06s\n[INFO]: :-) Your wasm pkg is ready to publish at /home/i/w/hello-wasm/pkg.\nâœ…  Your crate has been correctly compiled\n\nasset vendors-node_modules_text-encoding_index_js.index.js 623 KiB [emitted] (id hint: vendors)\nasset index.js 13.3 KiB [emitted] (name: main)\nasset pkg_index_js.index.js 7.28 KiB [emitted]\nasset index.html 232 bytes [emitted]\nruntime modules 7.32 KiB 11 modules\ncacheable modules 692 KiB\n  modules by path ./pkg/ 74.7 KiB\n    ./pkg/index.js 71 bytes [built] [code generated]\n    ./pkg/index_bg.js 3.25 KiB [built] [code generated]\n    ./pkg/index_bg.wasm 71.4 KiB [built] [code generated] [1 error]\n  modules by path ./node_modules/text-encoding/ 617 KiB\n    ./node_modules/text-encoding/index.js 258 bytes [built] [code generated]\n    ./node_modules/text-encoding/lib/encoding.js 99.1 KiB [built] [code generated]\n    ./node_modules/text-encoding/lib/encoding-indexes.js 518 KiB [built] [code generated]\n  ./index.js 88 bytes [built] [code generated]\n\nERROR in ./pkg/index_bg.wasm 1:0\nModule parse failed: Unexpected character '' (1:0)\nThe module seem to be a WebAssembly module, but module is not flagged as WebAssembly module for webpack.\nBREAKING CHANGE: Since webpack 5 WebAssembly is not enabled by default and flagged as experimental feature.\nYou need to enable one of the WebAssembly experiments via 'experiments.asyncWebAssembly: true' (based on async modules) or 'experiments.syncWebAssembly: true' (like webpack 4, deprecated).\nFor files that transpile to WebAssembly, make sure to set the module type in the 'module.rules' section of the config (e. g. 'type: \"webassembly/async\"').\n(Source code omitted for this binary file)\n @ ./pkg/index.js 1:0-40\n @ ./index.js 1:13-28\n\nwebpack 5.24.3 compiled with 1 error in 1526 ms\nerror Command failed with exit code 1.\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\n```\n\n`experiments.asyncWebAssembly: true`ã«ã—ã¦`module.rules`ã‚’è¨­å®šã—ã‚ã¨ã®ã“ã¨ãªã®ã§`webpack.config.js`ã‚’ä¿®æ­£ã—ãŸã€‚\n\n```diff\n+  experiments: {\n+    asyncWebAssembly: true,\n+  },\n+  module: {\n+    rules: [\n+      {\n+        test: /\\.wasm/,\n+        type: \"webassembly/async\",\n+      },\n+    ],\n+  },\n```\n\n`yarn build`ãŒé€šã£ãŸã®ã§`yarn serve`ã—ã¦ã¿ã‚‹ã€‚ã‚¨ãƒ©ãƒ¼ã€‚\n\n```bash\n$ yarn serve\nyarn run v1.22.10\n$ webpack-dev-server\ninternal/modules/cjs/loader.js:638\n    throw err;\n    ^\n\nError: Cannot find module 'webpack-cli/bin/config-yargs'\n    at Function.Module._resolveFilename (internal/modules/cjs/loader.js:636:15)\n    at Function.Module._load (internal/modules/cjs/loader.js:562:25)\n    at Module.require (internal/modules/cjs/loader.js:692:17)\n    at require (internal/modules/cjs/helpers.js:25:18)\n    at Object.\u003canonymous\u003e (/home/i/w/hello-wasm/node_modules/webpack-dev-server/bin/webpack-dev-server.js:65:1)\n    at Module._compile (internal/modules/cjs/loader.js:778:30)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:789:10)\n    at Module.load (internal/modules/cjs/loader.js:653:32)\n    at tryModuleLoad (internal/modules/cjs/loader.js:593:12)\n    at Function.Module._load (internal/modules/cjs/loader.js:585:3)\nerror Command failed with exit code 1.\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\n```\n\n[webpackã§Webã‚µãƒ¼ãƒãƒ¼ã§ã®ç¢ºèªã«webpack-dev-serverã¯ä¸å¯ | iwb.jp](https://iwb.jp/webpack-cli-dev-server-error-config-yargs/)ã§ã€`webpack-cli serve`ã‚’ä½¿ãˆã¨ã®ã“ã¨ãªã®ã§ã€ä¿®æ­£ã—ã¦ã¿ã‚‹ã€‚\n\n```diff\n-    \"serve\": \"webpack-dev-server\"\n+    \"serve\": \"webpack-cli serve --open --mode development\"\n```\n\nã‚¨ãƒ©ãƒ¼ãªãå‹•ã„ãŸã€‚ãŒã€ä½•ã‚‚èµ·ããªã„ã€‚ã©ã†ãªã£ã¦ã‚“ã ï¼Ÿã¨æ€ã£ã¦ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã‚’è¦‹ãŸã‚‰ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ãŸã€‚\n\n```\nTypeError: Cannot read property '__wbindgen_malloc' of undefined\n    at Module.greet (index_bg.js:115)\n    at eval (index.js:4)\n```\n\nâ€¦ç„¡ç†ã€‚ã‚‚ã†åˆ†ã‹ã‚“ãªã„ã€‚\nãã‚‚ãã‚‚ã‚µãƒ³ãƒ—ãƒ«å‹•ãã‚“ã‹ã‚ˆã€‚ã¨æ€ã£ã¦\n\nhttps://github.com/rustwasm/wasm-bindgen/tree/master/examples/hello_world\n\nã‚’è©¦ã—ãŸã‚‰å‹•ã„ãŸã€‚\nä½•ãŒé•ã†ã‚“ã ã¨æ€ã£ã¦ã‚ˆãè¦‹æ¯”ã¹ã‚‹ã¨`package.json`ãŒé•ã£ãŸã€‚\n\n```diff\n-    \"html-webpack-plugin\": \"^5.2.0\",\n-    \"webpack\": \"^5.24.3\",\n-    \"webpack-cli\": \"^4.5.0\",\n-    \"webpack-dev-server\": \"^3.11.2\"\n+    \"html-webpack-plugin\": \"^3.2.0\",\n+    \"webpack\": \"^4.29.4\",\n+    \"webpack-cli\": \"^3.1.1\",\n+    \"webpack-dev-server\": \"^3.1.0\"\n```\n\nã•ã£ãã‹ã‚‰ã‚¨ãƒ©ãƒ¼ã®å†…å®¹ã‚‚å¤§ä½“[[webpack]]ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ4ã˜ã‚ƒãªãã¦5ã ã‹ã‚‰å‡ºã¦ã‚‹é›°å›²æ°—ã‚’é†¸ã—å‡ºã—ã¦ã„ãŸã€‚ãªã‚“ã§ã‚‚æœ€æ–°ã˜ã‚ƒã ã‚ãªã‚“ã ã­ã‡ã€‚\n\nã¨ã‚Šã‚ãˆãš[[webpack]]ã‚ãŸã‚Šã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’4ã«ã—ã¦ã¿ã‚‹ã€‚\n\n```diff\n-    \"html-webpack-plugin\": \"^5.2.0\",\n-    \"webpack\": \"^5.24.3\",\n+    \"html-webpack-plugin\": \"^4.0.0\",\n+    \"webpack\": \"^4.0.0\",\n```\n\nå‹•ã„ãŸã€‚\n\n### ã¾ã¨ã‚\n\nãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆã‚ã›ã‚‹ã®å¤§äº‹ï¼ï¼ï¼\n"},{"id":"2021-03-06","content":"æœ€è¿‘æ°—ã«ãªã£ã¦ã„ãŸè¨€èªãŒäºŒã¤ã‚ã‚‹ã€‚\n\nä¸€ã¤ã¯[[TypeScript]]ã€ã‚‚ã†ä¸€ã¤ãŒ[[Rust]]ã ã€‚\n\n[[C++]]ãŒä¸€ç•ªé•·ã„æœŸé–“è§¦ã£ã¦ã„ã¦å¥½ããªè¨€èªãªã‚“ã ã‘ã©ã€C++17ã‚ãŸã‚Šã‹ã‚‰ã®é€²åŒ–ã®æ–¹å‘æ€§ã«é•å’Œæ„ŸãŒã‚ã£ã¦ãªã‚“ã ã‹ãªã‚ã¨æ€ã£ã¦ã„ã‚‹ã€‚é€†ã«[[Cè¨€èª]]ã«æˆ»ã£ã¦ã¿ã‚‹ã‹ï¼Ÿã¨æ€ã£ãŸã‚Šã‚‚ã—ãŸã‚“ã ã‘ã©ã€ãã‚“ãªæŠ˜ã«ã€ã©ã†ã‚‚[[Rust]]ãŒè‰¯ã•ãã†ã¨ã„ã†å™‚ã‚’èã„ãŸã€‚\n\nã¾ãšã¯å…¬å¼ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰èª­ã‚“ã§ã„ãã€‚\n\n[The Rust Programming Language æ—¥æœ¬èªç‰ˆ - The Rust Programming Language æ—¥æœ¬èªç‰ˆ](https://doc.rust-jp.rs/book-ja/title-page.html)\n\nè¨€èªã‚„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã‚“ã§ã‚‚ãªã‚“ã ã‘ã©ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒã—ã£ã‹ã‚Šã—ã¦ã„ã‚‹ã¨å®‰å¿ƒæ„ŸãŒã‚ã‚‹ã€‚\n\n---\n\nã¨ã‚Šã‚ãˆãš[[VS Code Remote Development]]ã§[[Rust]]ã®é–‹ç™ºç’°å¢ƒã‚’æ•´ãˆã‚‹ã€‚\n"}]},"__N_SSG":true},"page":"/","query":{},"buildId":"Q61FKq5QYu8xm0iRhUEF7","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-4f4acd756cef4fe6da1b.js"></script><script src="/_next/static/chunks/main-1f0b73d383aed819e4f2.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.29f9e2f3d4a33bafbaa5.js" async=""></script><script src="/_next/static/chunks/commons.3a16fc34825ffc7ba561.js" async=""></script><script src="/_next/static/chunks/pages/_app-f09e6d1885159ec7f6c1.js" async=""></script><script src="/_next/static/chunks/7ac61503aba6d10b58e3c266d97d99b7b5b3721a.c1b518faff21babf1a9f.js" async=""></script><script src="/_next/static/chunks/5f8a2089eac11fe3b358516a6b612033195d4834.09c9bf1e9518111d6ffd.js" async=""></script><script src="/_next/static/chunks/pages/index-9b12f7e5ac7c7e4e6afc.js" async=""></script><script src="/_next/static/Q61FKq5QYu8xm0iRhUEF7/_buildManifest.js" async=""></script><script src="/_next/static/Q61FKq5QYu8xm0iRhUEF7/_ssgManifest.js" async=""></script></body></html>